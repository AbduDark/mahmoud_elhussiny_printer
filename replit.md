# برنامج طباعة XPrinter XP-370B

## نظرة عامة
هذا تطبيق Windows WPF مكتوب بلغة C# للتحكم في طابعة حرارية من نوع XPrinter XP-370B. يتيح البرنامج:
- طباعة أرقام متسلسلة على ملصقات
- التحكم في حجم الورق والنص
- إضافة باركود اختياري لكل رقم
- طباعة عمودية: كل رقم على ملصق منفصل
- الباركود يطبع على يمين الرقم بحجم صغير

## البنية التقنية
- **اللغة**: C# .NET 8.0
- **الإطار**: WPF (Windows Presentation Foundation)
- **المكتبات**: 
  - System.Drawing.Common للتعامل مع الطابعات
  - Windows Print Spooler API (winspool.Drv) للطباعة الخام

## هيكل المشروع
```
mahmoud_elhussiny_printer/
├── App.xaml                      # تكوين التطبيق
├── App.xaml.cs                   # كود التطبيق الأساسي
├── MainWindow.xaml               # واجهة المستخدم الرسومية
├── MainWindow.xaml.cs            # منطق التطبيق
├── AssemblyInfo.cs               # معلومات التجميع
└── mahmoud_elhussiny_printer.csproj  # ملف المشروع
```

## التشغيل في Replit
نظراً لأن هذا تطبيق Windows، يتم تشغيله على Linux باستخدام:
- **Wine64**: طبقة توافق لتشغيل تطبيقات Windows على Linux
- **VNC**: لعرض واجهة المستخدم الرسومية في المتصفح

## بناء المشروع
```bash
cd mahmoud_elhussiny_printer
dotnet build -c Release
```

## التشغيل
```bash
wine64 ./mahmoud_elhussiny_printer/bin/Release/net8.0-windows/mahmoud_elhussiny_printer.exe
```

## ملاحظات مهمة
- **الطباعة الفعلية**: لن تعمل في بيئة Replit لأنه لا توجد طابعة فعلية متصلة
- **واجهة المستخدم**: يمكن رؤية الواجهة واختبار الوظائف، لكن الطباعة ستفشل عند عدم وجود طابعة
- **اللغة**: الواجهة بالعربية مع اتجاه النص من اليمين لليسار (RTL)

## التعديلات المطلوبة للعمل على Replit
تم إضافة الإعدادات التالية لملف `.csproj`:
```xml
<EnableWindowsTargeting>true</EnableWindowsTargeting>
<PackageReference Include="System.Drawing.Common" Version="8.0.0" />
```

## الميزات الحديثة
- **حفظ الإعدادات تلقائياً**: يتم حفظ جميع الإعدادات في ملف `printer_settings.json` بعد كل عملية طباعة
- **واجهة عصرية**: تصميم جديد بألوان احترافية وتنظيم أفضل
- **التحكم الكامل بالمواضع**: يمكن ضبط جميع مواضع النصوص والباركود
- **طباعة عمودية**: كل رقم يطبع على ملصق منفصل بتتابع (1، 2، 3، 4...)
- **باركود صغير**: الباركود يطبع على يمين الرقم بحجم أصغر (narrow)

## ملف الإعدادات
يتم حفظ الإعدادات في ملف `printer_settings.json` بالتنسيق التالي:
```json
{
  "Width": 1.57,
  "Height": 0.98,
  "FontSize": 2,
  "BarcodeHeight": 60,
  "LeftX": 20,
  "RightX": 200,
  "TopY": 10,
  "BottomY": 140,
  "BarcodeTopY": 30,
  "BarcodeBottomY": 160,
  "PrintBarcode": false
}
```

## التاريخ
- **2025-11-08**: 
  - استيراد المشروع وإعداده للعمل في Replit
  - إصلاح هيكل الكود (نقل RawPrinterHelper إلى class منفصل)
  - إضافة System.Drawing.Common package
  - إصلاح تحذيرات nullable reference
  - تعديل منطق الطباعة لطباعة 4 أرقام على ملصق واحد
  - تصميم واجهة جديدة احترافية باسم "برنامج محمود الحسيني للطباعة التسلسلية"
  - إضافة نظام حفظ وتحميل الإعدادات JSON
  - تغيير العرض الافتراضي من 3.15 إلى 1.57 بوصة
  - **تحديث**: تغيير الطباعة من 4 أرقام على ملصق واحد إلى طباعة عمودية (رقم واحد لكل ملصق)
  - **تحديث**: الباركود أصبح يطبع على يمين الرقم بحجم أصغر
